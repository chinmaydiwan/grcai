"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[299],{680:(e,t,s)=>{s.d(t,{A:()=>f});var r=s(5155),n=s(6874),i=s.n(n),a=s(2115),o=s(2099);function l(){let[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(0),[i,l]=(0,a.useState)(!1);async function c(){let{data:e,error:s}=await o.N.from("notifications").select("*").eq("status","unread").order("created_at",{ascending:!1});if(s)return void console.error("Error fetching notifications:",s);t(e||[]),n((null==e?void 0:e.length)||0)}(0,a.useEffect)(()=>{c();let e=o.N.channel("notifications");return e.on("system",{event:"INSERT",schema:"public",table:"notifications"},d).subscribe(),()=>{o.N.removeChannel(e)}},[]);let d=e=>{t(t=>[e,...t]),n(e=>e+1)};async function h(e){let{error:s}=await o.N.from("notifications").update({status:"read"}).eq("id",e);if(s)return void console.error("Error marking notification as read:",s);t(t=>t.filter(t=>t.id!==e)),n(e=>e-1)}return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{onClick:()=>l(!i),className:"relative rounded-full p-1 text-gray-400 hover:text-white focus:outline-none",children:[(0,r.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),s>0&&(0,r.jsx)("span",{className:"absolute -right-1 -top-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-xs text-white",children:s})]}),i&&(0,r.jsx)("div",{className:"absolute right-0 mt-2 w-80 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5",children:(0,r.jsx)("div",{className:"divide-y divide-gray-100",children:0===e.length?(0,r.jsx)("div",{className:"p-4 text-center text-gray-500",children:"No new notifications"}):e.map(e=>(0,r.jsxs)("div",{className:"flex items-start p-4 hover:bg-gray-50",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:e.message})]}),(0,r.jsx)("button",{onClick:()=>h(e.id),className:"ml-4 text-sm text-blue-500 hover:text-blue-600",children:"Mark as read"})]},e.id))})})]})}var c=s(1570);function d(){let[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(!0),[i,l]=(0,a.useState)(null);async function d(){let{data:{user:e}}=await o.N.auth.getUser();l((null==e?void 0:e.id)||null)}(0,a.useEffect)(()=>{d()},[]);let h=(0,a.useCallback)(async()=>{if(i)try{let{data:e,error:s}=await o.N.from("workflow_approvals").select("\n          *,\n          workflow_instances!inner(*, workflow_definitions(*))\n        ").eq("status","pending").eq("approver_id",i);if(s)throw s;t(e||[])}catch(e){console.error("Error fetching approvals:",e)}finally{n(!1)}},[i,t,n]),f=(0,a.useCallback)(()=>{if(!i)return;let e=o.N.channel("workflow_approvals").on("postgres_changes",{event:"*",schema:"public",table:"workflow_approvals"},e=>{e.new&&e.new.approver_id===i&&h()}).subscribe();return()=>{o.N.removeChannel(e)}},[i,h,o.N]);async function m(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{await (0,c.e)(e,t,s),await h()}catch(e){console.error("Error submitting approval:",e)}}return((0,a.useEffect)(()=>{if(i)return h(),f()},[i,h,f]),s)?(0,r.jsx)("div",{children:"Loading..."}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Pending Approvals"}),0===e.length?(0,r.jsx)("p",{className:"text-gray-500",children:"No pending approvals"}):(0,r.jsx)("ul",{className:"divide-y divide-gray-200",children:e.map(e=>{var t,s,n,i;return(0,r.jsx)("li",{className:"py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:null==(s=e.workflow_instance)||null==(t=s.workflow_definition)?void 0:t.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Step ",e.step_number+1,":",null==(i=e.workflow_instance)||null==(n=i.workflow_definition)?void 0:n.steps[e.step_number].name]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>m(e.id,"approved"),className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:"Approve"}),(0,r.jsx)("button",{onClick:()=>m(e.id,"rejected"),className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Reject"})]})]})},e.id)})})]})}let h=[{name:"Dashboard",href:"/dashboard",icon:e=>(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"})})},{name:"Risks",href:"/risks",icon:e=>(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})},{name:"Compliance",href:"/compliance",icon:e=>(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"})})},{name:"Approvals",href:"/approvals",icon:e=>(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 012.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 00.322-1.672V2.75a.75.75 0 01.75-.75 2.25 2.25 0 012.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 01-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 00-1.423-.23H5.904"})})}];function f(e){let{children:t}=e;return(0,r.jsxs)("div",{className:"flex min-h-screen",children:[(0,r.jsxs)("div",{className:"w-64 bg-gray-900",children:[(0,r.jsx)("div",{className:"flex h-16 items-center justify-center",children:(0,r.jsx)("h1",{className:"text-xl font-bold text-white",children:"GRC AI Platform"})}),(0,r.jsx)("nav",{className:"mt-5 space-y-1 px-2",children:h.map(e=>(0,r.jsxs)(i(),{href:e.href,className:"group flex items-center rounded-md px-2 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white",children:[(0,r.jsx)(e.icon,{className:"mr-3 h-6 w-6"}),e.name]},e.name))})]}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col",children:[(0,r.jsx)("header",{className:"bg-white shadow",children:(0,r.jsxs)("div",{className:"mx-auto flex items-center justify-between px-4 py-6 sm:px-6 lg:px-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)(d,{}),(0,r.jsx)(l,{})]})]})}),(0,r.jsx)("main",{className:"flex-1 px-4 py-6 sm:px-6 lg:px-8",children:t})]})]})}},1570:(e,t,s)=>{s.d(t,{e:()=>n});var r=s(2099);async function n(e,t,s){try{let{data:n,error:i}=await r.N.from("workflow_approvals").update({status:t,comments:s}).eq("id",e).select().single();if(i)throw i;let{data:a,error:o}=await r.N.from("workflow_instances").select("*, workflow_definitions(*)").eq("id",n.workflow_instance_id).single();if(o)throw o;let l=a.workflow_definitions.steps[a.current_step],{data:c,error:d}=await r.N.from("workflow_approvals").select("status").eq("workflow_instance_id",a.id).eq("step_number",a.current_step);if(d)throw d;let h=c.filter(e=>"approved"===e.status).length;if(c.filter(e=>"rejected"===e.status).length>0)await r.N.from("workflow_instances").update({status:"rejected"}).eq("id",a.id);else if(h>=l.required_approvals)if(a.current_step===a.workflow_definitions.steps.length-1)await r.N.from("workflow_instances").update({status:"completed"}).eq("id",a.id);else{let e=a.current_step+1;await r.N.from("workflow_instances").update({current_step:e,status:"in_progress"}).eq("id",a.id);let t=a.workflow_definitions.steps[e];await r.N.from("workflow_approvals").insert(t.approver_roles.map(t=>({workflow_instance_id:a.id,step_number:e,approver_id:t})))}return n}catch(e){throw console.error("Error submitting approval:",e),e}}},2099:(e,t,s)=>{s.d(t,{N:()=>r});let r=(0,s(4821).UU)("https://yxinpbqkdjzxifklscdf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl4aW5wYnFrZGp6eGlma2xzY2RmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4MTU1NTMsImV4cCI6MjA2MzM5MTU1M30._hUHphXm3V0oFhteWlMXbjsVLR1hCsjIVR6uQbJMW5Y")}}]);