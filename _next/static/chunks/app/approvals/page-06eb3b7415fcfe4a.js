(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[605],{1515:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(5155),n=s(2115),a=s(680),i=s(2099),l=s(1570);function o(){let[e,t]=(0,n.useState)([]),[s,o]=(0,n.useState)(!0);async function c(){try{let{data:{user:e}}=await i.N.auth.getUser();if(!e)return;let{data:s,error:r}=await i.N.from("workflow_approvals").select("\n          *,\n          workflow_instances!inner(*, workflow_definitions(*))\n        ").eq("approver_id",e.id).order("created_at",{ascending:!1});if(r)throw r;t(s||[])}catch(e){console.error("Error fetching approvals:",e)}finally{o(!1)}}function d(){return i.N.channel("workflow_approvals").on("postgres_changes",{event:"*",schema:"public",table:"workflow_approvals"},async e=>{let{data:{user:t}}=await i.N.auth.getUser();if(!t)return;let s=e.new;s&&s.approver_id===t.id&&c()}).subscribe()}async function u(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{await (0,l.e)(e,t,s),await c()}catch(e){console.error("Error submitting approval:",e)}}return((0,n.useEffect)(()=>{c();let e=d();return()=>{e.unsubscribe()}},[c,d]),(0,n.useEffect)(()=>{let e=d();return()=>{e.unsubscribe()}},[c]),s)?(0,r.jsx)(a.A,{children:(0,r.jsx)("div",{children:"Loading..."})}):(0,r.jsx)(a.A,{children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Workflow Approvals"})}),0===e.length?(0,r.jsx)("p",{className:"text-gray-500",children:"No approvals found"}):(0,r.jsx)("div",{className:"mt-6 overflow-hidden rounded-lg bg-white shadow",children:(0,r.jsx)("ul",{className:"divide-y divide-gray-200",children:e.map(e=>{var t,s;return(0,r.jsx)("li",{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:null==(t=e.workflow_instance)?void 0:t.workflow_definition.name}),(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Status: ",(0,r.jsx)("span",{className:"font-medium",children:e.status})]}),(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Step ",e.step_number+1,":",null==(s=e.workflow_instance)?void 0:s.workflow_definition.steps[e.step_number].name]})]}),"pending"===e.status&&(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("button",{onClick:()=>u(e.id,"approved"),className:"inline-flex items-center rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700",children:"Approve"}),(0,r.jsx)("button",{onClick:()=>u(e.id,"rejected"),className:"inline-flex items-center rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700",children:"Reject"})]})]})},e.id)})})})]})})}},9173:(e,t,s)=>{Promise.resolve().then(s.bind(s,1515))}},e=>{var t=t=>e(e.s=t);e.O(0,[606,299,441,684,358],()=>t(9173)),_N_E=e.O()}]);